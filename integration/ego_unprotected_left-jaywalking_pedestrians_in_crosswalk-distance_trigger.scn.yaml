metadata:
  name: Left turn following vehicle with jaywalking pedestrians
  scenario_version: v0.96
  tags:
  - sunnyvale
  - unprotected_left
  - distance_trigger

include:
- file: include/global_observers.inc.yaml
- file: include/vehicle_shape.inc.yaml

map:
  key: sunnyvale

trip_agent:
  behavior:
  - generate_route:
      start:
        utm:
          y: 4141069.5825689156
          x: 586624.2139853388
      dest: {utm: {x: 586497.0678372134, y: 4140991.34898102}}

projection_settings:
  utm:
    zone: 10
    north: true

sim_end:
  until:
  - timeout: {secs: 30s}

observers:
- name: Max Velocity
  always: {motion: {fail_if_vel_above_mps: 16.0}}
- name: Driveable region
  always: {region: {on_driveable_surface: true}}

agents:
- ego:
    initial_position:
      point:
        utm:
          y: 4141069.5825689156
          x: 586624.2139853388
      heading: 2.8475922671514775
    initial_velocity_mps: 0
    behaviors:
    - lane_keeping:
        actions:
        - duration: 10s
          modify_speed:
            acceleration: 1
            speed_mps: 7
    - lane_keeping:
        actions:
        - duration: 3s
          modify_speed:
            acceleration: -1
            speed_mps: 4
    - lane_keeping:
        actions:
        - duration: 20s
          modify_speed:
            acceleration: 1
            speed_mps: 7
- obstacle:
    id: 1
    type: VEHICLE
    model:
      static:
        height: 1.5
        point:
        - {x: 2.3, y: 0.9}
        - {x: 2.3, y: -0.9}
        - {x: -2.3, y: -0.9}
        - {x: -2.3, y: 0.9}
    initial_state:
      point: {utm: {y: 4141073.37186891, x: 586612.1979492317}}
      heading: 2.802737793731133
      speed_mps: 6
    behaviors:
    - route_following:
        tangent_distance: 0.2
        constant_velocity:
        final_pose:
          y: 4141028.1932674637
          x: 586506.3143641938
          heading: 0
        minimum_attractor_distance: 2
- obstacle:
    id: 2
    type: PEDESTRIAN
    model:
      static:
        height: 1.65
        point:
        - {x: 0, y: 0.35}
        - {x: 0.2, y: 0.25}
        - {x: 0.2, y: -0.25}
        - {x: 0, y: -0.35}
        - {x: -0.2, y: -0.25}
        - {x: -0.2, y: 0.25}
    initial_state:
      point: {utm: {x: 586552.7502131922, y: 4141113.507260182}}
      heading: -1.9
    behaviors:
    - until:
        distance:
          obstacle_b:
            ego:
          trigger_below_m: 25
      simple_wait: true
    - waypoint_following:
        relative_waypoints:
        - duration: 9s
          movement: {x: -16.4, y: -26.5}
    - simple_wait: true
- obstacle:
    id: 3
    type: PEDESTRIAN
    model:
      static:
        height: 1.65
        point:
        - {x: 0, y: 0.35}
        - {x: 0.2, y: 0.25}
        - {x: 0.2, y: -0.25}
        - {x: 0, y: -0.35}
        - {x: -0.2, y: -0.25}
        - {x: -0.2, y: 0.25}
    initial_state:
      point: {utm: {x: 586530.7718899045, y: 4141086.729871749}}
      heading: 2.894
    behaviors:
    - until:
        distance:
          obstacle_a: {ego: true}
          trigger_below_m: 30
      simple_wait: true
    - waypoint_following:
        relative_waypoints:
        - speed_mps: 1
          movement: {x: -13.006159667042084, y: 5.911890952847898}
    - simple_wait: true
- obstacle:
    id: 4
    type: VEHICLE
    model:
      static:
        height: 1.5
        point:
        - {x: 2.3, y: 0.9}
        - {x: 2.3, y: -0.9}
        - {x: -2.3, y: -0.9}
        - {x: -2.3, y: 0.9}
    initial_state:
      point:
        utm:
          y: 4141025.87389641
          x: 586512.9484307116
      heading: 1.313412872374606
      speed_mps: 6
    behaviors:
    - route_following:
        tangent_distance: 0.2
        constant_velocity:
        final_pose:
          y: 4141056.6260282965
          x: 586603.4727957627
          heading: 0
        minimum_attractor_distance: 2
- obstacle:
    id: 5
    type: VEHICLE
    model:
      static:
        height: 1.5
        point:
        - {x: 2.3, y: 0.9}
        - {x: 2.3, y: -0.9}
        - {x: -2.3, y: -0.9}
        - {x: -2.3, y: 0.9}
    initial_state:
      point:
        utm:
          y: 4141159.238099708
          x: 586464.8846500157
      heading: -0.8380221916049635
      speed_mps: 6
    behaviors:
    - route_following:
        tangent_distance: 0.2
        constant_velocity:
        final_pose:
          y: 4141212.4292827514
          x: 586560.1422615907
          heading: 0
        minimum_attractor_distance: 2
- obstacle:
    id: 6
    type: PEDESTRIAN
    model:
      static:
        height: 1.65
        point:
        - {x: 0, y: 0.35}
        - {x: 0.2, y: 0.25}
        - {x: 0.2, y: -0.25}
        - {x: 0, y: -0.35}
        - {x: -0.2, y: -0.25}
        - {x: -0.2, y: 0.25}
    initial_state:
      point: {utm: {x: 586550.9286566477, y: 4141113.418932041}}
      heading: -1.9
    behaviors:
    - until:
        distance:
          obstacle_a: {ego: true}
          trigger_below_m: 25
      simple_wait: true
    - waypoint_following:
        relative_waypoints:
        - duration: 11s
          movement: {x: -16.4, y: -26.5}
    - simple_wait: true
- obstacle:
    id: 7
    type: PEDESTRIAN
    model:
      static:
        height: 1.65
        point:
        - {x: 0, y: 0.35}
        - {x: 0.2, y: 0.25}
        - {x: 0.2, y: -0.25}
        - {x: 0, y: -0.35}
        - {x: -0.2, y: -0.25}
        - {x: -0.2, y: 0.25}
    behaviors:
    - until:
        distance:
          obstacle_a: {obstacle_id: 7}
          obstacle_b:
            ego:
          trigger_below_m: 25
      waypoint_following:
        initial_waypoint:
          point: {utm: {x: 586555.0274323063, y: 4141113.675105528}}
          heading: -1.9
        relative_waypoints:
        - duration: 200s
          movement: {x: 0, y: 0}
    - waypoint_following:
        relative_waypoints:
        - duration: 10s
          movement: {x: -16.4, y: -28.5}
    - simple_wait: true
- obstacle:
    id: 8
    type: PEDESTRIAN
    model:
      static:
        height: 1.65
        point:
        - {x: 0, y: 0.35}
        - {x: 0.2, y: 0.25}
        - {x: 0.2, y: -0.25}
        - {x: 0, y: -0.35}
        - {x: -0.2, y: -0.25}
        - {x: -0.2, y: 0.25}
    initial_state:
      point:
        utm:
          x: 586518.3945451155
          y: 4141093.2665678943
      heading: -0.2
    behaviors:
    - until:
        distance:
          obstacle_a: {ego: true}
          trigger_below_m: 30
      simple_wait: true
    - waypoint_following:
        relative_waypoints:
        - speed_mps: 2
          movement: {x: 13.006159667042084, y: -5.911890952847898}
    - simple_wait: true
- obstacle:
    id: 9
    type: PEDESTRIAN
    model:
      static:
        height: 1.65
        point:
        - {x: 0, y: 0.35}
        - {x: 0.2, y: 0.25}
        - {x: 0.2, y: -0.25}
        - {x: 0, y: -0.35}
        - {x: -0.2, y: -0.25}
        - {x: -0.2, y: 0.25}
    initial_state:
      point:
        utm:
          x: 586518.309153956
          y: 4141090.619441861
      heading: -0.2
    behaviors:
    - until:
        distance:
          obstacle_a: {obstacle_id: 9}
          obstacle_b:
            ego:
          trigger_below_m: 30
      simple_wait: true
    - waypoint_following:
        relative_waypoints:
        - speed_mps: 0.75
          movement: {x: 13.006159667042084, y: -5.911890952847898}
    - simple_wait: true
extra_data:
  use_ego_behavior: true
